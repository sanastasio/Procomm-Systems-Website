// Unify - Interface
// Developed for Unify by Unit Interactive
// unify.unitinteractive.com
//
// Built on jQuery - jquery.com and jQuery UI - jqueryui.com
// Text Engine built on Tiny MCE - tinymce.moxiecode.com
// Code syntax highlighting via CodeMirror - marijn.haverbeke.nl/codemirror/
//
var undoC;var un1fyGlobalPath;var un1fyPath;var un1fyFiles;var un1fyHTMLEdit;var un1fyFilePath;var un1fyImagePath;var fileTarget;var origImg;var bm;$(function(){$(window).bind("load",unifyStart);unifyGlobals();$("#un1fyPageSrc").height($(window).height()-60)});var unifyStart=function(){ifrDoc=getIfrDoc();$(window).unbind("load");$("#un1fyTopBanner").css("background","url(unify-images/loading.gif) repeat-x bottom");undoC=0;un1fyGlobalPath=null;un1fyPath=null;un1fyFiles=null;un1fyHTMLEdit=null;un1fyFilePath=null;un1fyImagePath=null;$("#un1fyDashboard a").bind("click",function(){if($("#un1fyPageEdits .edit",ifrDoc).length){navAwayPrompt("settings/","loc")}else{window.location="settings/"}});$("#un1fyLogout a").bind("click",logoutPrompt);unifySetup()};var unifySetup=function(){if(un1fyGlobalPath==null||un1fyHTMLEdit==null){var e;try{e=document.createElement('<iframe name="un1fyPrefsFrame" >')}catch(t){e=document.createElement("iframe")}$(e).attr({id:"un1fyPrefsFrame",name:"un1fyPrefsFrame",src:"functions/getsaveprefs.php",application:"yes"}).css("display","none");$("body").append(e)}else{getGlobals(un1fyGlobalPath,un1fyHTMLEdit,un1fyFiles,un1fyFilePath,un1fyImagePath)}};var getGlobals=function(e,t,n,r,i,s){var o=window.location.href.split("/"+e+"/");un1fyGlobalPath=o[0]+"/"+e;un1fyPath=e;un1fyHTMLEdit=t;un1fyFiles=n;un1fyFilePath=r;un1fyImagePath=s;un1fyExFolders=i;$("#un1fyPrefsFrame").load("functions/getpath.php",function(){$("#un1fyPrefsFrame").remove()});initPage();setTimeout(function(){$("#un1fyPageSrc").bind("load",initPage)},100)};var initPage=function(){getIfrDoc();cancel();$("#un1fyGlobalUndo, #un1fyGlobalRedo").remove();$(".unify cufon, .unifyRepeat cufon",ifrDoc).each(function(){$(this,ifrDoc).replaceWith($(this,ifrDoc).find("cufontext").html())});$(".unify embed.sIFR-flash, .unifyRepeat embed.sIFR-flash, .unify object.sIFR-flash, .unifyRepeat object.sIFR-flash",ifrDoc).remove();$(".unify .sIFR-replaced",ifrDoc).removeClass("sIFR-replaced");$("html",ifrDoc).removeClass("sIFR-hasFlash");$(".unify span.sIFR-alternate, .unifyRepeat span.sIFR-alternate",ifrDoc).each(function(){$(this,ifrDoc).replaceWith($(this,ifrDoc).html())});linkBind();unifyCSS()};var unifyCSS=function(){var e='<style type="text/css" app="unify">\n'+"a.un1fyIcon,"+"a.un1fyRepCopyDrag,"+"a.un1fyRepDelete,"+'a.un1fyRepIcon 			{ display: block; position: absolute !important; text-indent: -5000px; background-image: url("'+un1fyGlobalPath+'/unify-images/unify_sprite1.png") !important; background-repeat: no-repeat ; width: 36px !important; height: 32px !important; overflow: hidden !important; background-position: -638px -56px !important; border: none; background-color: none; text-decoration: none; z-index: 9000; cursor: pointer; padding: 0 !important; min-height: 32px !important; max-height: 32px !important; min-width: 36px !important; max-width: 36px !important; }\n'+"a.un1fyIcon:hover 			{ background-position: -638px -88px !important; }"+"a.un1fyRepIcon 			{ background-position: -674px -56px !important; }\n"+"a.un1fyRepIcon:hover 		{ background-position: -674px -88px !important; }"+".un1fyPlaceholder 			{ display: block; background: #000 !important; opacity: 0.15 !important; *filter: alpha(opacity=15) !important; }\n"+"a.un1fyRepCopyDrag 		{ width: 32px !important; min-width: 32px !important; max-width: 32px !important; height: 32px !important; background-position: -710px -56px !important; }\n"+"a.un1fyRepCopyDrag:hover 	{ background-position: -710px -88px !important; }\n"+"a.un1fyRepDelete 			{ width: 32px !important; min-width: 32px !important; max-width: 32px !important; height: 32px !important; background-position: -742px -56px !important; }\n"+"a.un1fyRepDelete:hover 	{ background-position: -742px -88px !important; }\n"+".unifyRepeatArea 			{ overflow: hidden !important; display: block; }\n"+".un1fyRep 					{ cursor: move !important; *zoom: 1; position: relative; }\n"+"#un1fyUploadImgClone 		{ visibility: hidden; position: absolute; left: -5000px; top: 0; padding: 0; margin: 0; display: block; }\n"+"#un1fyVidClone 			{ visibility: hidden; position: absolute; left: -5000px; top: 0; padding: 0; margin: 0; display: block; }\n"+"embed.un1fyFlash,"+"object.un1fyFlash 			{ visibility: hidden !important; z-index: 0 !important; }\n"+"</style>";$("head",ifrDoc).append(e);changeTitle()};var changeTitle=function(){var e=retUrl();e=e.split("//");e=e[1];document.title="Editing :: "+e;unifyGlobals();initElements()};var initElements=function(){var e=new RegExp("\ba\b|abbr|acronym|\bb\b|basefont|bdo|big|br|cite|code|dfn|em\b|font|\bi\b|input|kbd|label|\bq\b|\bs\b|samp|select|small|span|strike|strong|sub|textarea|tt|\bu\b|var","i");var t=0;var n=0;var r=$(".unify, .unifyRepeatArea .unifyRepeat, .unifyRepeatArea",ifrDoc);if(r.length){$.each(r,function(){if($(this,ifrDoc).attr("class").match(/unifyRepeat\b/g)){var r="un1fyEditArea un1fyRep",i="un1fyRepEdit"+n}else if($(this,ifrDoc).attr("class").match(/unifyRepeatArea/g)){var r="un1fyEditArea un1fyRepArea";var i="un1fyEditArea"+t}else{var r="un1fyEditArea";var i="un1fyEditArea"+t}if(!$(this,ifrDoc)[0].tagName.match(e)&&!$(this,ifrDoc).parents(".unify, .unifyRepeat").length){$(this,ifrDoc).addClass(r).attr({unifyid:i});if($(this,ifrDoc).attr("class").match(/unifyRepeat\b/)){if(getCurStyle($(this,ifrDoc)[0],"position")=="static"&&$(this,ifrDoc)[0].tagName!="TR"){$(this,ifrDoc).css("position","relative")}}if($(this,ifrDoc)[0].tagName=="TABLE"&&$(this,ifrDoc).attr("class").match(/unifyRepeatArea/)){$(this,ifrDoc).css("display","table")}}if(!$(this,ifrDoc).attr("class").match(/unifyRepeat\b/g)){t++}else{n++}})}$("body",ifrDoc).append($("<form/>",ifrDoc).attr({id:"un1fyPageEdits",action:un1fyGlobalPath+"/functions/save.php",method:"POST",target:"un1fyPubIframe","accept-charset":"UTF-8,ISO-8859-15"}).css("display","none"));createIcons();unifyRepStart()};var createIcons=function(){destroyIcons();$("#un1fyTopBanner").css("background","none");$(".un1fyEditArea",ifrDoc).each(function(){var e=$(this,ifrDoc).attr("class").match(/un1fyRep/g)?true:false;var t=$(this,ifrDoc).attr("unifyid").replace(/un1fyRepEdit|un1fyEditArea/,"");var n=e?"un1fyRepIcon":"un1fyIcon";var r=e?"un1fyRepEdit":"un1fyEditArea";var i=getCurStyle($(this,ifrDoc)[0],"display")!="none"?"block":"none";var s=getCurStyle($(this,ifrDoc)[0],"visibility");var o=getCurStyle($(this,ifrDoc)[0],"padding-top");var u=$(this,ifrDoc).offset();var a=u.left-40<0?0:u.left-40;a=a>$("body",ifrDoc).width()-40?$("body",ifrDoc).width()-50:a;if(!$(this,ifrDoc).attr("class").match(/un1fyRepArea/g)&&i!="none"&&s!="hidden"){$("body",ifrDoc).append($("<a/>",ifrDoc).addClass(n).attr({id:n+t,title:"Edit this area",href:"javascript:"}).html("Update now").css({top:u.top+parseInt(o),left:a}).bind("mousedown",function(){change(t,n)}))}if(!$(this,ifrDoc).attr("class").match(/unifyRepeatArea/g)&&e){$(this,ifrDoc).unbind("mouseover").bind("mouseover",function(){$(".un1fyRepDelete, .un1fyRepCopyDrag",$(this,ifrDoc)).css("display","block")}).unbind("mouseout").bind("mouseout",function(){$(".un1fyRepDelete, .un1fyRepCopyDrag",$(this,ifrDoc)).css("display","none")})}})};var unifyRepStart=function(){if($(".unifyRepeatArea",ifrDoc).length){$(".unifyRepeatArea",ifrDoc).each(function(e){$(this,ifrDoc).addClass("un1fyRepeatArea"+e);if($(this,ifrDoc)[0].tagName=="TABLE"){$(this,ifrDoc).removeClass("clearfix")}});unifyRepBind()}};var unifyRepBind=function(){var e=repAreas();repCopyDragDelete();$(".unifyRepeatArea",ifrDoc).sortable("destroy").sortable({items:$(".un1fyRep",ifrDoc),cancel:"a.un1fyRepCopyDrag, a.un1fyRepDelete, a.un1fyIcon",tolerance:"pointer",containment:"parent",cursor:"move",placeholder:"un1fyPlaceholder",forcePlaceholderSize:true,forceHelperSize:true,opacity:.7}).unbind("sortstart").bind("sortstart",function(){repOverlay($(this,ifrDoc),e)}).find(".un1fyIcon").unbind("mousedown").bind("mousedown",change).end().find("*").disableSelection();$(".un1fyRep",ifrDoc).draggable({connectToSortable:$(".ui-sortable",ifrDoc),handle:$("a.un1fyRepCopyDrag",ifrDoc),helper:"clone",containment:"parent",revert:"invalid",cursor:"move",opacity:.7}).each(function(){if($(this,ifrDoc)[0].tagName=="TR"){$(this,ifrDoc).removeClass("clearfix")}$(this,ifrDoc).width(getCurStyle(this,"width"))});$(".un1fyRepDelete",ifrDoc).unbind("mousedown").bind("mousedown",function(){repDeletePrompt($(this,ifrDoc))});if($.browser.msie){$(".un1fyRep",ifrDoc).each(function(){$(this,ifrDoc)[0].style.removeAttribute("filter")})}$("body",ifrDoc).unbind("sortstart").bind("sortstart",function(e,t){setTimeout(function(){$(".un1fyPlaceholder",ifrDoc).height($(".ui-sortable-helper",ifrDoc).height()+"px").width($(".ui-sortable-helper",ifrDoc).width()+"px").attr("class","un1fyPlaceholder "+$(".ui-sortable-helper",ifrDoc).attr("class"));$("tr.un1fyPlaceholder",ifrDoc).append($("<td/>",ifrDoc).attr("colspan",$("tr.ui-sortable-helper",ifrDoc).find("td").length))},0);destroyIcons()})};var repCopyDragDelete=function(){$("a.un1fyRepCopyDrag, a.un1fyRepDelete",ifrDoc).remove();$(".un1fyRep",ifrDoc).each(function(){var e=$(this,ifrDoc)[0].tagName=="TR"?true:false;var t=e?$(this,ifrDoc).find("td, th")[0]:this;var n=$(t,ifrDoc).offset();var r=n.left<36?36:e?Math.round(n.left):0;var i=e?Math.round(n.top)+"px !important":0;var s='<a class="un1fyRepDelete" title="Delete element" href="javascript:" style="display:none;top:'+i+"px !important;left:"+(r+36)+'px !important">Delete element</a>';var o='<a class="un1fyRepCopyDrag" title="Drag from here to create a copy" href="javascript:" style="display:none;top:'+i+"px !important;left:"+r+'px !important">Drag from here to create a copy</a>';$(t,ifrDoc).prepend(o).prepend(s)})};var repAreas=function(){var e=new Array;$(".unifyRepeatArea",ifrDoc).each(function(t){$(this,ifrDoc).find(".un1fyEle").css("visibility","visible").removeClass("un1fyEle");var n=$("<div/>",ifrDoc).append($(this,ifrDoc).clone()).html();$(this,ifrDoc).find(".unifyRepeat").each(function(){if(!$(this,ifrDoc).find(".un1fyRepDelete").length){repCopyDragDelete()}});e[t]=n});return e};var repOverlay=function(e,t){$("a.un1fyRepCopyDrag, a.un1fyRepDelete",ifrDoc).remove();$("body",ifrDoc).unbind("sortstop").bind("sortstop",function(n,r){var i=Math.round(Math.random()*1e4);if(!$("[unifyid=un1fyRepEdit"+i+"]",ifrDoc).length){r.item.attr("unifyid","un1fyRepEdit"+i)}else{r.item.attr("unifyid","un1fyRepEdit"+i+1)}repDone(e,t)})};var repEditDone=function(e){var t=getTinyDoc();var n=repAreas();var r=$(e,ifrDoc).parents(".unifyRepeatArea");var i=e.tagName.match(/(h[0-9]|p)/i)?false:true;var s=!i&&$("[unifyid]",t).find(e.tagName).length?$("[unifyid]",t).parent().html():$("[unifyid]",t).html();if(s){s=cleanContent(s,i,t);var o=$(e,ifrDoc).clone();if($(e,ifrDoc)[0].tagName.match(/TR|THEAD|TBODY/)){o.html(s)}else{o[0].innerHTML=s}$(e,ifrDoc).replaceWith(o)}else{$(e,ifrDoc).html("&nbsp;")}repDone(r,n)};var repImageDone=function(e){var t=repAreas();var n=$(e,ifrDoc).parents(".unifyRepeatArea",ifrDoc);var r=$("#un1fyImgStatArea img").attr("src").match(/^\.\.\//)?$("#un1fyImgStatArea img").attr("src").replace(/^\.\.\//,""):$("#un1fyImgStatArea img").attr("src");var i=null;if($("#un1fyImgClass").val()!=""){i=$("#un1fyImgClass").val()+" unifyRepeat"}else{i="unifyRepeat"}$(e,ifrDoc).addClass("un1fyImgClass").attr({src:r,alt:$("#un1fyImgAltTxt").val(),width:$("#un1fyImgStatsWidth").val(),height:$("#un1fyImgStatsHeight").val()});if($(e.parentNode,ifrDoc).attr("href")&&$("#un1fyImgLink").val()!=$(e.parentNode,ifrDoc).attr("href")){$(e.parentNode,ifrDoc).attr({href:$("#un1fyImgLink").val()})}if($(e.parentNode,ifrDoc).attr("rel")&&$("#un1fyImgRel").val()!=$(e.parentNode,ifrDoc).attr("rel")){$(e.parentNode,ifrDoc).attr({rel:$("#un1fyImgRel").val()})}repDone(n,t)};var repDone=function(e,t){e.addClass("un1fyEle");var n=e.attr("class").match(/un1fyRepeatArea[0-9]+/g)[0].replace("un1fyRepeatArea","");var r=e.clone().find("a.un1fyRepCopyDrag, a.un1fyRepDelete").remove().end().html();r=cleanContent(r,true,ifrDoc);addEdits(r,$(t[n])[0],false);unifyRepBind();$(".un1fyEle",ifrDoc).removeClass("un1fyEle");createIcons()};var repDeletePrompt=function(e){overlay();if(!$("#un1fyPrompt").length){$("body").append($("<div/>").attr("id","un1fyPromptWrap").load("unify-temps/prompt.html",function(){$("#un1fyPrompt h4.un1fyPromptTitle").html("Delete Repeatable");$("#un1fyPrompt p").html("Are you sure you want to delete this element?");$("#un1fyPromptBtn").attr("title","delete").html("delete").bind("click",function(){repDelete(e)});$("#un1fyCancelBtn").bind("click",cancel);showPrompt("nodrag")}))}};var repDelete=function(e){var t=repAreas();var n=$(e,ifrDoc).parents(".unifyRepeatArea",ifrDoc);$(e,ifrDoc).parents(".un1fyRep").remove();repDone(n,t);cancel()};var frameShim=function(){$("#un1fyFrameShim").css("display","block").height($(document).height()).width($(document).width()).unbind("mouseup").bind("mouseup",frameShimDestroy)};var frameShimDestroy=function(){$("#un1fyFrameShim").css("display","none")};var getBookmark=function(e){bm=tinyMCE.activeEditor.selection.getBookmark(e)};var setBookmark=function(){tinyMCE.activeEditor.selection.moveToBookmark(bm)};var keyHandler=function(){$(document).bind("keypress",function(e){switch(e.which||e.keyCode){case 27:$("#un1fyUploadIframe, #un1fyFileFrame, , #un1fyFolderFrame").remove();cancel()}});var e=getTinyDoc();if(e){$("img",e).bind("mousedown",function(){tinyMCE.execCommand("mceSelectNode",false,this)})}$(document).bind("keydown",function(e){if(e.metaKey){$(document).bind("keydown",function(e){switch(e.which||e.keyCode){case 37:e.preventDefault();break;case 39:e.preventDefault();break}})}switch(e.which||e.keyCode){case 8:if(!$("#un1fyPromptWrap").length){e.preventDefault();return true}}})};var tinyKeyEvents=function(e){$(e).unbind("keyup").unbind("keydown").bind("keydown",function(t){var n=tinyMCE.activeEditor.selection.getNode();switch(t.which||t.keyCode){case 224:case 17:$(e).unbind("keydown").bind("keydown",function(t){switch(t.which||t.keyCode){case 65:if(e.createRange){var n=e.createRange();var r=document.getElementById("un1fyEditContent_ifr").contentWindow.getSelection()||window.getSelection();if(r.rangeCount>0){r.removeAllRanges()}n.selectNodeContents($("[unifyid]",e)[0]);r.addRange(n)}else{var n=e.body.createTextRange();n.moveToElementText($("[unifyid]",e)[0]);n.select()}t.preventDefault();break}}).unbind("keyup").bind("keyup",function(t){switch(t.which||t.keyCode){case 224:case 17:tinyKeyEvents(e);break}});break;case 27:cancel();break}}).focus(function(){tinyKeyEvents(e)})};var setCaret=function(e,t){var n=$(e,t).html();if(t.createRange){var r=t.createRange();var i=document.getElementById("un1fyEditContent_ifr").contentWindow.getSelection()||window.getSelection();if(i.rangeCount>0){i.removeAllRanges()}if(n=="<br>"){r.selectNodeContents(e)}else{r.setStart(e,1);r.setEnd(e,1)}i.addRange(r)}else{var r=t.body.createTextRange();if(n=="<br>"){$(e,t).empty()}r.moveToElementText(e);r.collapse(false);r.select()}$("#caret",t).removeAttr("id")};var retUrl=function(){if(frames["un1fyPageSrc"].contentWindow){ret=frames["un1fyPageSrc"].contentWindow.location.href}else{ret=frames["un1fyPageSrc"].location.href}return ret};var getTinyDoc=function(){if($("#un1fyEditContent_ifr").length){var e=document.getElementById("un1fyEditContent_ifr");e=e.contentWindow?e.contentWindow.document:e.contentDocument}else{e=false}return e};var saveFeedback=function(e){userBar(e);$("#un1fyPageEdits textarea, #un1fyPubIframe",ifrDoc).remove()};var userBar=function(e){if(!$("#un1fyUserBar").length){$("<div/>").addClass("un1fyUserBar").attr("id","un1fyUserBar").insertAfter("#un1fyTopBanner").append($("<div/>").addClass("un1fyUserBarIn").attr("id","un1fyUserBarIn").append($("<p/>")));if(e.match(/successfully/gi)){$("#un1fyUserBar").find("p").html("<strong>"+e+"</strong>").end().css("opacity","0.4").animate({opacity:"1"},800);if(e.match(/published/gi)){$("#un1fyRestore a").attr("title","Restore the last published version").unbind("click").bind("click",restorePrompt).removeAttr("style")}$("#un1fyUserBarIn").prepend($("<a/>").attr("href","javascript:").html("Refresh This Page").bind("click",ifrReload));var t=setTimeout(function(){$("#un1fyUserBar").animate({opacity:"0"},300,function(){$("#un1fyUserBar").remove()})},5500)}else{$("#un1fyUserBar").find("p").html(e).end().hide().css({opacity:"1.0",backgroundColor:"#c6242b"}).slideDown(300);$("#un1fyUserBarIn").prepend($("<a/>").attr("href","javascript:").html("Hide This Bar").bind("click",hideUserBar))}}else{$("#un1fyUserBar").remove();window.clearTimeout(t);userBar(e)}};var hideUserBar=function(){if($("#un1fyUserBar").css("position")=="relative"){$("#un1fyUserBar").animate({marginTop:"-26px"},300,function(){$("#un1fyUserBar").remove()})}else{$("#un1fyUserBar").animate({opacity:"0"},200,function(){$("#un1fyUserBar").remove()})}};var change=function(e,t){if(t=="un1fyRepIcon"){var n=$("[unifyid=un1fyRepEdit"+e+"]",ifrDoc)[0];$(n,ifrDoc).parents(".unifyRepeatArea").unbind("mousedown")}else{var n=$("[unifyid=un1fyEditArea"+e+"]",ifrDoc)[0]}overlay(n)};var ifrReload=function(){$("#un1fyPageSrc").unbind("load");if(frames["un1fyPageSrc"].contentWindow){window.frames["un1fyPageSrc"].contentWindow.location.reload(true);window.frames["un1fyPageSrc"].contentWindow.location.reload(true)}else{window.frames["un1fyPageSrc"].location.reload(true);window.frames["un1fyPageSrc"].location.reload(true)}$("#un1fyPageSrc").bind("load",initPage)};var editorStyles=function(e){$("link, style",ifrDoc).not('[media="print"], [media="handheld"], [app="unify"]').each(function(){var t=$(this,ifrDoc).attr("href");if(t){t=t.match(/^http(s*):\/\//)?t:fpath()+t;var n=$("<div/>",ifrDoc).append($(this,ifrDoc).clone().attr("href",t));$("head",e).html($("head",e).html()+$(n,ifrDoc).html());n=null}else{var n=$("<div/>",ifrDoc).append($(this,ifrDoc).clone());$("head",e).html($("head",e).html()+$(n,ifrDoc).html());n=null}})};var windowOrient=function(){if($("li#un1fyFullscreen a.un1fyMinimize").length){$("#un1fyEditWrap .mceIframeContainer").width("auto")}var e=$(".un1fyEle",ifrDoc)[0];if(e){var t=getTinyDoc();setTimeout(function(){editorSize(t,e)},100)}};var hideFlash=function(){$("object, embed",ifrDoc).addClass("un1fyFlash");if($("#un1fyEditContent_ifr").length){var e=getTinyDoc();$("object, embed",e).addClass("un1fyFlash")}};var editorSize=function(e,t){var n=getCurStyle($(t,ifrDoc)[0],"margin-left")!="auto"?getCurStyle($(t,ifrDoc)[0],"margin-left"):0;var r=getCurStyle($(t,ifrDoc)[0],"margin-right")!="auto"?getCurStyle($(t,ifrDoc)[0],"margin-right"):0;var i=$(t,ifrDoc).width()+parseInt(n)+parseInt(r)+44;i=i-(parseInt(n)+parseInt(r))=="44"&&$(t,ifrDoc).css("width")!="auto"?i+parseInt($(t,ifrDoc).css("width")):i;if($.browser.msie){$("#un1fyEditContent_ifr").width(i+20)}else{$("#un1fyEditContent_ifr").width(i)}$(".mceIframeContainer").height("auto");var s=e.body.scrollHeight;var o=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:document.body.clientHeight;if(s+63>o-130){$("td.mceIframeContainer").height(o-130)}else{setTimeout(function(){$("td.mceIframeContainer, #un1fyEditContent_ifr",$("#un1fyEditWrap")).height(s)},0)}var u="";if($("#un1fyEditContent_bullist").length&&$("#un1fyEditContent_ifr")[0].offsetWidth+10<=640){u=640}else{if($.browser.msie){u=$("#un1fyEditContent_ifr").width()+20}else{u=$("#un1fyEditContent_ifr").width()+8}}if(u<300){u=300}$("#un1fyEditWrap, #un1fyEditContent_tbl td.mceIframeContainer, #un1fyEditContent_tbl td.mceToolbar").width(u).css("min-width",u);$("#un1fyEditTopUl").css("min-width",u-14);$("#un1fyEditWrap").animate({opacity:1},"slow").find("#un1fyEditDone a").bind("click",function(){if($(t).attr("class").match(/unifyRepeat\b/g)){repEditDone(t)}else{done(t)}}).end().find("#un1fyEditCancel a").bind("click",cancel).end().find("a.fullscreen").unbind("click").bind("click",function(){editorFullscreen($(this).attr("rel"))}).removeClass("un1fyMinimize").attr({title:"Maximize this window"}).html("Maximize this window").end().find("#un1fyEditHTML").unbind("click").bind("click",function(){htmlPrompt(t)}).end();dragOn($("#un1fyEditWrap")[0],$("#un1fyEditTopUl")[0]);editorPos(e,t,s+63)};var editorPos=function(e,t,n){var r=$(t,ifrDoc).offset();$("#un1fyEditContent_ifr").css({"float":"none",margin:"0"});var i=ifrDoc.documentElement.scrollTop?ifrDoc.documentElement.scrollTop:ifrDoc.body.scrollTop;var s=ifrDoc.documentElement.scrollLeft?ifrDoc.documentElement.scrollLeft:ifrDoc.body.scrollLeft;if(r.top-i-36<0){$("#un1fyEditWrap").css("top","0px")}else{if(!$("#un1fyUserBar").length){$("#un1fyEditWrap").css("top",r.top-i-34)}else{$("#un1fyEditWrap").css("top",r.top-i-14)}}if(r.left-s-14<0){$("#un1fyEditWrap").css("left","0px")}else if(r.left+$("#un1fyEditWrap").width()>$("body",ifrDoc).width()){$("#un1fyEditWrap").css("left",r.left-s-$("#un1fyEditWrap").width()+$(t,ifrDoc).width()+32);$("#un1fyEditContent_ifr").css({"float":"right",clear:"both"})}else{$("#un1fyEditWrap").css("left",r.left-s-24);$("#un1fyEditContent_ifr").css("float","left")}var o=r.top-i+n;var u=r.left-s+$("#un1fyEditWrap").width();if(o>$(window).height()){frames["un1fyPageSrc"].scrollTo(s,r.top-48);i=ifrDoc.documentElement.scrollTop?ifrDoc.documentElement.scrollTop:ifrDoc.body.scrollTop;if(r.top+i-48<0){$("#un1fyEditWrap").css("top","0px")}else{if(!$("#un1fyUserBar").length){$("#un1fyEditWrap").css("top",r.top-i-34)}else{$("#un1fyEditWrap").css("top",r.top-i-16)}}}if(u>$(window).width()){frames["un1fyPageSrc"].scrollTo(r.left-48,i);s=ifrDoc.documentElement.scrollLeft?ifrDoc.documentElement.scrollLeft:ifrDoc.body.scrollLeft;if(r.left+s-48<0){$("#un1fyEditWrap").css("left","0px")}else{$("#un1fyEditWrap").css("left",r.left-s-48)}}};var editorCleanUp=function(){var e=getTinyDoc();fixImgs();$("body",e).find(".un1fyIcon").remove().end().find("img").each(function(){$(this,e).removeAttr("_mce_src")}).end().find("a").each(function(){if($(this,e).attr("href")){var t=$(this,e).attr("href");if(t.match(window.location)){$(this,e).attr("href",t.replace(window.location+"#","#"))}$(this,e).removeAttr("_mce_href")}}).end().find("*").each(function(){if(getCurStyle(this,"display")=="none"||getCurStyle(this,"visibility")=="hidden"){$(this,e).css({display:"block",visibility:"visible"})}}).end().bind("mouseup",function(){var t=tinyMCE.activeEditor.selection.getNode();if(t.tagName=="EMBED"&&$(t,e).parent()[0].tagName=="OBJECT"){tinyMCE.execCommand("mceSelectNodeDepth",false,1)}})};var editorFullscreen=function(e){$(e).height($(document).height()).css({opacity:"1",top:"0",left:"0"}).find("a.fullscreen").addClass("un1fyMinimize").unbind("click").bind("click",function(){if(e=="#un1fyEditWrap"){windowOrient()}else{htmlPrompt()}}).attr("title","Minimize this window").html("Minimize this window");if(e=="#un1fyEditWrap"){$(e).width($(window).width());$(".mceIframeContainer").height($(document).height()-84).width($(window).width());$("#un1fyEditContent_ifr").css({"float":"none",margin:"0 auto"})}else{$(e).width($(window).width()-40).css("margin","0");$("#un1fyHtmlEditAreaTA, #un1fyCodeWrap").height($(window).height()-130).width($(e).width()-28).focus()}};var unifyGlobals=function(){$("#un1fyRestore a").attr("title","Restore the last published version").unbind("click").bind("click",restorePrompt);if(!$("#un1fyGlobalUndo").length||undoC==0){$("#un1fyUndo a").css({opacity:"0.5",backgroundPosition:"-62px 0",cursor:"default"}).unbind("click").attr("title","Cannot Undo at this time")}else{$("#un1fyUndo a").css("opacity","1.0").unbind("click").bind("click",undo).attr("title","Undo").removeAttr("style")}if(!$("#un1fyGlobalRedo").length||!$("#un1fyGlobalRedo .un1fyEle"+undoC).length){$("#un1fyRedo a").css({opacity:"0.5",backgroundPosition:"-134px 0",cursor:"default"}).unbind("click",redo).attr("title","Cannot Redo at this time")}else{$("#un1fyRedo a").css("opacity","1.0").unbind("click").bind("click",redo).attr("title","Redo").removeAttr("style")}if(!$("#un1fyPageEdits textarea",ifrDoc).length||undoC==0){$("#un1fyCxl a").css("opacity","0.5").unbind("click",cancelAllPrompt).attr("title","Cannot Cancel All at this time").css({backgroundPosition:"-206px 0",cursor:"default"});$("#un1fyPublish a").css("opacity","0.5").unbind("click",publish).attr("title","You must make edits before publishing").css({backgroundPosition:"-385px 0",cursor:"default"})}else{$("#un1fyCxl a").css("opacity","1.0").unbind("click").bind("click",cancelAllPrompt).attr("title","Clear all of these changes").removeAttr("style");$("#un1fyPublish a").css("opacity","1.0").unbind("click").bind("click",publish).attr("title","Publish these changes to your site").removeAttr("style")}};var changePageEdits=function(e,t){var t=t?t:$(e,ifrDoc).attr("unifyid").replace("un1fyEditArea","");if($("#un1fyEditTA"+t,ifrDoc).length){if(e.tagName=="IMG"){var n=$(e,ifrDoc).attr("class").replace(/(\s)*\bun1fyEle[0-9]+\b(\s)*/gi,"");var r="src::"+$(e,ifrDoc).attr("src")+",alt::"+$(e,ifrDoc).attr("alt")+",class::"+n+",width::"+$(e,ifrDoc).attr("width")+",height::"+$(e,ifrDoc).attr("height")+",link::"+$(e.parentNode,ifrDoc).attr("href")+",rel::"+$(e.parentNode,ifrDoc).attr("rel");if(typeof document.textContent!="undefined"){$("#un1fyEditTA"+t,ifrDoc)[0].textContent=r}else{$("#un1fyEditTA"+t,ifrDoc)[0].innerText=r}}else{var i=cleanContent($(e,ifrDoc).find("a.un1fyRepCopyDrag, a.un1fyRepDelete").remove().end().html(),true,ifrDoc);if(typeof document.textContent!="undefined"){$("#un1fyEditTA"+t,ifrDoc)[0].textContent=i}else{$("#un1fyEditTA"+t,ifrDoc)[0].innerText=i}}}};var cleanContent=function(e,t,n){if(!t){e=e.replace(/<p[^>]*>/gi,"");e=e.replace(/<\/p>/gi,"<br />")}e=e.replace(/<br\s*data-mce-bogus=\"1\">/gi,"");e=e.replace(/(style|\w*-mce-[^\s=]*|unselectable|contentEditable|unifyid|jQuery[0-9]*)=\"[^\"]*\"\s*/gi,"");e=e.replace(/(<\/*[^>]+)\s>/gi,"$1>");e=e.replace(/\s*(un1fyEditArea|un1fyRep|ui-draggable)\s*/gi,"");e=e.replace(/<(\/?)b>|<b(\s[^>]+)>/gi,"<$1strong$2>");e=e.replace(/<(\/?)i>|<i(\s[^>]+)>/gi,"<$1em$2>");e=e.replace(window.location+"#","#");return e};var outerHTML=function(e){if("outerHTML"in e){return e.outerHTML}else{return $("<div/>").append($(e).clone()).html()}};var getCurStyle=function(e,t){var n=getTinyDoc();var r=n?n:ifrDoc;var i;var s=$(e,r)[0].currentStyle;if(s){if(t.match(/-/)){t=t.replace(/-([A-z])/gi,function(e,t){return t.toUpperCase()})}i=s[t]?s[t]:$(e,r).css(t);if(i==undefined){i=""}}else{i=r.defaultView.getComputedStyle(e,null).getPropertyValue(t)}return i};var contrast=function(){var e=getTinyDoc();$(".mceIframeContainer").css("background-color","rgb(255,255,255)");$("#un1fyEditorContrast").bind("mousewheel",function(e,t){var n=Math.round(Math.abs(t)*20);var r=$(".mceIframeContainer").css("background-color");var i=r.replace(/(rgb\(\s*|\))/,"");i=i.split(",");var s=parseInt(i[0]);var o=parseInt(i[1]);var u=parseInt(i[2]);if(t>0){s+=n;o+=n;u+=n}else{s-=n;o-=n;u-=n}var a;if(s>255){a="rgb(255,255,255)"}else if(s<0){a="rgb(0,0,0)"}else{a="rgb( "+s+","+o+","+u+" )"}$(this).css("background-color",a);$(".mceIframeContainer").css("background-color",a);return false}).css("background-color","rgb(255,255,255)")};var folderLoader=function(e){var t;try{t=document.createElement('<iframe name="un1fyFolderFrame" >')}catch(n){t=document.createElement("iframe")}$(t).attr({id:"un1fyFolderFrame",name:"un1fyFolderFrame",src:"functions/folderload.php?type="+e,application:"yes"}).css("display","none").appendTo("body")};var folderOption=function(e,t){if(t=="img"){$("#un1fyImgFolder").append($("<option/>").html(e).val(e))}else{$("#un1fyFolder").append($("<option/>").html(e).val(e))}};var destroyFolderLoader=function(){$("#un1fyFolderFrame").remove();$("#un1fyImgFolderDefault, #un1fyFolderDefault").html("Please select a folder")};var fixImgs=function(e){var t=getTinyDoc();$("img",t).each(function(){var n=$(this,t).attr("_mce_src")||$(this,t).attr("src");n=e?n.replace(/^(\.\.\/)/,""):n.replace(/^(\/)/,"");n=n.match(/^http(s*):\/\//)?n:fpath()+n;$(this,t).attr("src",n)})};var destroyIcons=function(){$(".un1fyIcon, .un1fyRepIcon",ifrDoc).remove()};var eleHTML=function(e){var t=$(e,ifrDoc).clone().wrap($("<div/>",ifrDoc));var n=$(t,ifrDoc).parent().html();n=cleanContent(n,true,ifrDoc);return n};var createTextArea=function(e){$ele=$(e,ifrDoc);if(!$("#un1fyEditWrap").length){hideFlash();$ele.addClass("un1fyEle").css("visibility","hidden");$("body").prepend($("<div/>").attr("id","un1fyEditWrapTemp").load("unify-temps/editor.html",function(){$("#un1fyEditWrapTemp").replaceWith($("#un1fyEditWrapTemp").html());var t=$("<span/>",ifrDoc).addClass("un1fyEditContent").attr("id","un1fyEditContent").append($ele.clone().attr({unifyid:$ele.attr("unifyid"),style:"float: none !important; visibility: visible; position: relative !important; margin: 0 !important; top: 0 !important; left: 0 !important; *zoom: 1; overflow: hidden;"}).addClass($ele.attr("class")).removeClass("unify").removeClass("un1fyEle").removeClass("un1fyEditArea").find(".un1fyFlash").removeClass("un1fyFlash").end().find("a.un1fyRepCopyDrag, a.un1fyRepDelete").remove().end().find("*").enableSelection().end());var n=0;var r=parentBP(e,false);var i=$ele[0].tagName.match(/(h[0-9]|p)/i)?false:true;var s="abbr article aside audio canvas details figcaption figure footer header hgroup mark meter nav output progress section summary time video";if(!s.match($ele[0].tagName)&&$.browser.msie||!$.browser.msie){$ele.parents().not("body,html").each(function(){var e="margin: 0 !important; width: auto !important; height: auto !important; float: none !important; position: relative !important; top: 0 !important; left: 0 !important; border: none !important; -moz-box-shadow: 0 !important; -webkit-box-shadow: 0 !important; box-shadow: 0 !important;";if(n==0){e+=" padding: 20px !important;";if(r.img){r.left+=20;r.top+=20;e+=" background-position: "+r.left+"px "+r.top+"px !important;"}}else{e+=" padding: 0 !important;";if(r.img){e+=" background-position: "+r.left+"px "+r.top+"px !important;"}}r=parentBP(this,r);$(t,ifrDoc).wrapInner($(this,ifrDoc).clone().empty().addClass("clearfix").attr("style",e).removeAttr("unifyid"));n++})}else{t=t.innerHTML}var o=$("<div/>",ifrDoc).append(t);$("#un1fyEditWrap").css("opacity","0").html($("#un1fyEditWrap").html()+$(o,ifrDoc).html());tinyMCEBuilder(e,i)}))}};var parentBP=function(e,t){var n=$(e,ifrDoc).parent()[0];if(!t){t={top:0,left:0,offleft:0,offtop:0,img:false}}var r=$(e,ifrDoc).offset();var i=$(n,ifrDoc).offset();var s=getCurStyle($(n,ifrDoc)[0],"background-position").split(" ");var o="";var e="";var u="";var a="";u=0-(r.left-i.left);a=0-(r.top-i.top);if(!s[0].match(/%/)||s[0]=="0%"){o=t.offleft+u}else{var f=.01*parseInt(s[0]);o=Math.round(f*u*-1)}if(s[1]&&(!s[1].match(/%/)||s[1]=="0%")){e=t.offtop+a}else{var f=.01*parseInt(s[1]);e=Math.round(f*a*-1)}var t={left:o,top:e,offleft:t.offleft+u,offtop:t.offtop+a,img:n.tagName!="BODY"&&getCurStyle(n,"background-image")!="none"?true:false};return t};var tinyMCEBuilder=function(e,t){var n=null;var r="p,pre,h1,h2,h3,h4,h5,h6,dd,dt";var i=new RegExp("^( "+r.replace(/,/gi,"|")+" )$","i");var s=e.tagName.match(i)?true:false;tinyMCE.init({mode:"exact",theme:"advanced",plugins:"deflist,file,video,images,links,paste,tables,lists",theme_advanced_buttons1:!t?un1fyFiles=="Y"?"bold,italic,link,image,file":"bold,italic,link,image":un1fyFiles=="Y"?"formatselect,bold,italic,link,image,video,file,bullist,numlist,deflist,table":"formatselect,bold,italic,link,image,video,bullist,numlist,deflist,table",theme_advanced_buttons2:"",theme_advanced_buttons3:"",theme_advanced_buttons4:"",theme_advanced_blockformats:r,theme_advanced_toolbar_location:"top",theme_advanced_toolbar_align:"left",height:"auto",width:"auto",apply_source_formatting:true,remove_linebreaks:true,entity_encoding:"",cleanup:true,cleanup_on_startup:$.browser.msie?false:true,remove_trailing_nbsp:true,use_native_selects:true,extended_valid_elements:"@[unifyid|id|dir|class|style],ol,ul,li,dt,dd,div,abbr,article,aside,audio,canvas,datalist,details,embed[*],figure,figcaption,footer,header,hgroup,mark,menu,meter,nav,output,object[*],param[*],progress,section,summary,time,video,pre,code,p,h1,h2,h3,h4,h5,h6,[border|cellspacing|cellpadding|width],tr[rowspan],td[colspan],th[colspan],thead,tbody,tfoot",invalid_elements:"script",skin:"default",convert_urls:false,elements:"un1fyEditContent",verify_html:true,object_resizing:false,auto_resize:false,paste_auto_cleanup_on_paste:true,setup:function(e){e.onPaste.add(function(e,t){setTimeout(function(){fixImgs(true)},100)})},oninit:"tinyInit"})};var tinyInit=function(){var e=getTinyDoc();editorStyles(e);if($("body",ifrDoc).attr("class")){$("body",e).addClass($("body",ifrDoc).attr("class"))}if($("body",ifrDoc).attr("id")){$("body",e).attr("id",$("body",ifrDoc).attr("id"))}if(un1fyHTMLEdit=="Y"){$("<a/>").attr({id:"un1fyEditHTML",href:"javascript:",title:"View and edit the HTML"}).html("html").prependTo("td.mceToolbar")}$("#un1fyEditContent_toolbar1 a").each(function(){$(this).find("span").html($(this).attr("id").replace("un1fyEditContent_",""))});if($.browser.msie){ieBind()}contrast();editorCleanUp();setTimeout(windowOrient,0)};var ieBind=function(){var e=getTinyDoc();$("#un1fyEditContent_ifr").attr("allowTransparency","true").css({background:"transparent"});$("[unifyid]",$("body",e)).bind("mousedown",function(e){getInnerEle(e)})};var getInnerEle=function(e){var t=getTinyDoc();var n=t.body.createTextRange();n.moveToElementText($(e.target,t)[0]);n.collapse(false);n.select();$("[unifyid]",t).unbind("mousedown").bind("blur",function(e){$(this,t).bind("mousedown",function(e){getInnerEle(e)})}).find("*").unbind("mousedown").bind("blur",function(e){$(this,t).bind("mousedown",function(e){getInnerEle(e)})})};var tinyEvents=function(e){var t=getTinyDoc();if(e.type=="paste"){e.stopPropagation()}};var createUndo=function(e){if(!$("#un1fyGlobalUndo").length){$('<div id="un1fyGlobalUndo" />').append($('<div id="un1fyUndoNum'+undoC+'" />').append($(e).addClass("un1fyEle"+undoC))).appendTo("body")}else{if(!$("#un1fyUndoNum"+undoC).length){$('<div id="un1fyUndoNum'+undoC+'" />').append($(e).addClass("un1fyEle"+undoC)).appendTo("#un1fyGlobalUndo")}else{e=$(e).wrap("<div />").parent().html();$ele=$(e.replace(new RegExp("s*un1fyEle[0-9]+","g"),"")).addClass("un1fyEle"+undoC);$("#un1fyUndoNum"+undoC).replaceWith($('<div id="un1fyUndoNum'+undoC+'" />').append($ele))}}};var createRedo=function(e){if(!$("#un1fyGlobalRedo").length){$("<div/>").attr("id","un1fyGlobalRedo").appendTo("body");$("<div/>").attr("id","un1fyRedoNum"+undoC).appendTo("#un1fyGlobalRedo");$("#un1fyRedoNum"+undoC).html($("<div/>",ifrDoc).append($(e,ifrDoc).clone()).html())}else{if(!$("#un1fyRedoNum"+undoC).length){$("<div/>").attr("id","un1fyRedoNum"+undoC).appendTo("#un1fyGlobalRedo");$("#un1fyRedoNum"+undoC).html($("<div/>",ifrDoc).append($(e,ifrDoc).clone()).html())}else{$("#un1fyRedoNum"+undoC).html("");$("#un1fyRedoNum"+undoC).html($("<div/>",ifrDoc).append($(e,ifrDoc).clone()).html())}}$("#un1fyRedo").css("opacity","1.0").find("a").attr("title","Redo last action").bind("click",redo)};var showPrompt=function(e,t){hideFlash();if(!t){$("#un1fyPrompt:hidden").css({display:"block",opacity:"0"}).fadeTo(300,1,function(){if($.browser.msie){$(this,ifrDoc)[0].style.removeAttribute("filter")}})}else{$("#un1fyPrompt:hidden").css("display","block")}if($("#un1fyPromptCancel").length){$("#un1fyPromptCancel").bind("click",cancel)}if(!$("#un1fyEditWrap").length){keyHandler()}else{$(document).unbind("keydown");$("#un1fyPrompt input:first, #un1fyPrompt textarea:first").focus();keyHandler()}if(!e){dragOn($("#un1fyPrompt")[0],$("#un1fyPromptTitle, #un1fyPromptTop"))}if($("#un1fyEditWrap").length){overlay(null)}};var getEd=function(){if($("#un1fyEditWrap").length){if(tinyMCE.activeEditor.selection.getNode().tagName=="IMG"||tinyMCE.activeEditor.selection.getNode().tagName=="EMBED"||tinyMCE.activeEditor.selection.getNode().tagName=="OBJECT"){return tinyMCE.activeEditor.selection.getNode()}else{return false}}else{return false}};var imageEditBuilder=function(e){if(getTinyDoc()){getBookmark("simple")}if(!$("#un1fyPromptWrap").length){$("body").append($("<div/>").attr("id","un1fyPromptWrap").load("unify-temps/image-editor.html",function(){if(e){$(e,ifrDoc).addClass("un1fyEle");$("#un1fyImgAltTxt").val($(e,ifrDoc).attr("alt"));var t=$(e,ifrDoc).attr("class").replace(/(?:\s)*\b(unify|un1fyEle|un1fyEle[0-9]+|unifyRepeat|un1fyEditArea)\b(?:\s)*/gi,"");$("#un1fyImgClass").val(t);if(e.parentNode.tagName=="A"){$("#un1fyImgLink").val($(e.parentNode,ifrDoc).attr("href"));$("#un1fyImgRel").val($(e.parentNode,ifrDoc).attr("rel"))}$("#un1fyPromptBtn").attr("title","Apply these changes").html("done").bind("click",function(){if($(e,ifrDoc).attr("class").match(/unifyRepeat\b/g)){repImageDone(e)}else{imageDone(e)}});imageStatBuilder(e)}else{var n=getEd();if(n){$("#un1fyImgAltTxt").val($(n).attr("alt"));$("#un1fyImgClass").val($(n).attr("class"));if(n.parentNode.tagName=="A"){$("#un1fyImgLink").val($(n.parentNode).attr("href"));$("#un1fyImgRel").val($(n.parentNode).attr("rel"))}imageStatBuilder(n)}else{$("#un1fyPromptTitle").html("Insert Image");imageStatBuilder()}}folderLoader("img");showPrompt()}))}};var origImgSet=function(e){var t=getEd();var e=t?t:e?e:$("[unifyid]",getTinyDoc())[0];var n={t:parseInt(getCurStyle(e,"padding-top")),r:parseInt(getCurStyle(e,"padding-right")),l:parseInt(getCurStyle(e,"padding-left")),b:parseInt(getCurStyle(e,"padding-bottom"))};var r={top:parseInt(getCurStyle(e,"border-top-width")),right:parseInt(getCurStyle(e,"border-right-width")),bottom:parseInt(getCurStyle(e,"border-bottom-width")),left:parseInt(getCurStyle(e,"border-left-width"))};origImg={width:e.offsetWidth-n.l-n.r-r.left-r.right,height:e.offsetHeight-n.t-n.b-r.top-r.bottom}};var imageStatBuilder=function(e,t){if(tinyMCE.activeEditor){setBookmark()}var n=true;if($("#un1fyImgStatArea").length){n=$("#un1fyOrigSize:checked").length?true:false;$("#un1fyImgStatArea").remove()}if(e){var r=$(e,ifrDoc).attr("src");r=r.match(/^http(s*):\/\//)?r:fpath()+r.replace(/^(\/)/,"");var i=r.split("/");i=i[i.length-1];var s='<h4 id="un1fyImageTitle" class="un1fyImageTitle">'+i+"<span>"+r+'</span></h4><img alt="'+$(e).attr("alt")+'" src="'+r+'" class="un1fyImgPreview"><form action="javascript:" method="post" id="un1fyImgStats" class="un1fyImgStats"><label><input id="un1fyOrigSize" class="un1fyOrigSize" type="checkbox"';if(n){s+=' checked="checked"'}s+='>Resize image to fit</label><label><input id="un1fyImgStatsWidth" name="un1fyImgStatsWidth" type="text" value="'+$(e,ifrDoc).width()+'">width:</label><label><input id="un1fyImgStatsHeight" name="un1fyImgStatsHeight" type="text" value="'+$(e,ifrDoc).height()+'">height:</label><label class="un1fyConstrainLabel"><input id="un1fyConstrain" class="un1fyConstrain" type="checkbox">Keep proportions</label></form>';$("<div/>").addClass("un1fyImgStatArea clearfix").attr("id","un1fyImgStatArea").html(s).insertAfter("#un1fyImgChoose");$("ul.un1fyImgProperties").css("display","inline");$("#un1fyPrompt").addClass("un1fyImgVidSelect");if(t){$("#un1fyImgStats").prepend($("<label/>").attr("id","un1fyImgSize").html("file size:").prepend($("<span/>")));if(t.length>3){$("#un1fyImgSize span").html(t.slice(0,t.length-3)+" kb")}else{$("#un1fyImgSize span").html(t+" bytes")}}var o=$("img.un1fyEle",ifrDoc).length||getEd()?e:false;if(!$("img.un1fyEle",ifrDoc).length){if($("#un1fyPromptBtn").html()=="apply"){$("#un1fyPromptBtn").attr("title","Insert image").html("insert")}$("#un1fyPromptBtn").unbind("click").bind("click",function(){imageInsert()})}$("#un1fyApplyBtn").css("display","block");if($(e,ifrDoc).attr("id")!="un1fyUploadImgClone"){origImgSet(e)}else if($(".un1fyEle",ifrDoc).length){origImgSet($(".un1fyEle",ifrDoc)[0])}else{origImgSet($("[unifyid]",getTinyDoc())[0])}if(origImg){imageOrigSize(e)}else{imageOrigSize()}}else{$("#un1fyPrompt").removeClass("un1fyImgVidSelect");$("ul.un1fyImgProperties").css("display","none");$("#un1fyPromptBtn").attr("title","Insert new image").html("apply").bind("click",imageSrc);$("#un1fyApplyBtn").css("display","none");imageBind()}$("body",ifrDoc).focus()};var imageOrigSize=function(e){$("#un1fyOrigSize").unbind("click").bind("click",function(){imageOrigSize(e)});if($("#un1fyOrigSize:checked").length){var t=origImg.height;if($("#un1fyUploadImgClone",ifrDoc).length){var n=$("#un1fyUploadImgClone",ifrDoc)[0].offsetWidth,r=$("#un1fyUploadImgClone",ifrDoc)[0].offsetHeight;t=parseInt(r)*(parseInt(origImg.width)/parseInt(n));t=Math.round(t)}$("#un1fyImgStatsWidth").replaceWith($("<input/>").attr({name:"un1fyImgStatsWidth",id:"un1fyImgStatsWidth",type:"text",disabled:"disabled"}).css({backgroundColor:"#bbb",color:"#666"}).val(origImg.width));$("#un1fyImgStatsHeight").replaceWith($("<input/>").attr({name:"un1fyImgStatsHeight",id:"un1fyImgStatsHeight",type:"text",disabled:"disabled"}).css({backgroundColor:"#bbb",color:"#666"}).val(t));$(".un1fyConstrainLabel").css("color","#666").find("input").attr({disabled:"disabled",checked:"checked"})}else{var i=$("#un1fyImgStatsHeight").val();var s=$("#un1fyImgStatsWidth").val();$("#un1fyImgStatsWidth").replaceWith($("<input/>").attr({name:"un1fyImgStatsWidth",id:"un1fyImgStatsWidth",type:"text"}));$("#un1fyImgStatsHeight").replaceWith($("<input/>").attr({name:"un1fyImgStatsHeight",id:"un1fyImgStatsHeight",type:"text"}));if($("#un1fyUploadImgClone",ifrDoc).length){$("#un1fyImgStatsWidth").val($("#un1fyUploadImgClone",ifrDoc)[0].offsetWidth);$("#un1fyImgStatsHeight").val($("#un1fyUploadImgClone",ifrDoc)[0].offsetHeight)}else{$("#un1fyImgStatsWidth").val(s);$("#un1fyImgStatsHeight").val(i)}$(".un1fyConstrainLabel").css("color","#ccc").find("input").removeAttr("disabled")}imageConstrain(e);imageBind()};var imageConstrain=function(e){$("#un1fyConstrain").unbind("click").bind("click",function(){imageConstrain(e)});if($("#un1fyConstrain:checked").length&&!$("#un1fyOrigSize:checked").length){$("#un1fyImgStatsWidth, #un1fyImgStatsHeight").bind("keyup",function(){var t=this.id=="un1fyImgStatsWidth"?"un1fyImgStatsWidth":"un1fyImgStatsHeight";changeSize(t,e)})}else{$("#un1fyImgStatsWidth, #un1fyImgStatsHeight").unbind("keyup")}};var changeSize=function(e,t){var t=t?t:$(".un1fyEle",ifrDoc)[0];var n=$("#"+e).val();var r=$("#un1fyImgStatsWidth").val();var i=$("#un1fyImgStatsHeight").val();if($("#un1fyUploadImgClone",ifrDoc).length){t=$("#un1fyUploadImgClone",ifrDoc)}var s=$(t,ifrDoc).width();var o=$(t,ifrDoc).height();var u=e=="un1fyImgStatsHeight"?s/o:o/s;if(r/i!=u){var a=e=="un1fyImgStatsHeight"?"un1fyImgStatsWidth":"un1fyImgStatsHeight";var f=$("#"+e).val()*u;f=Math.round(f);$("#"+a).val(f)}};var imageBind=function(){imageRel();$("#un1fyImgLink").unbind("keyup").bind("keyup",imageRel);fBrowseBind();$("#un1fyImgUpload").unbind("change").bind("change",function(){imageLoader(false)});$("#un1fyApplyBtn").unbind("click").bind("click",imageSrc)};var imageRel=function(){if($("#un1fyImgLink").val()!=""){$(".un1fyImgRel").removeClass("disabled").find("input").removeAttr("disabled")}else{$(".un1fyImgRel").addClass("disabled").find("input").attr("disabled","disabled")}};var imageLoader=function(e){if($("#un1fyImgUpload").val()!=""){$("#un1fyImgUploadAlert").remove();$("#un1fyImgAddress").val("http://");$("#un1fyImgStatArea").css("min-height",$("#un1fyImgStatArea").height()).addClass("un1fyUploadingImg").find("*").css("display","none");var t;try{t=document.createElement('<iframe name="un1fyImgUploadIframe" >')}catch(n){t=document.createElement("iframe")}$(t).attr({id:"un1fyImgUploadIframe",name:"un1fyImgUploadIframe",application:"yes"}).appendTo("body");if(e){$("#un1fyImgLoc").attr("action","functions/upload.php?type=img&over=true")}$("#un1fyImgLoc")[0].submit()}};var imageOverwritePrompt=function(){$("<p/>").addClass("un1fyUploadAlert un1fyPromptAlert").attr("id","un1fyUploadAlert").html('This file already exists. <a href="javascript:" id="un1fyFileOver">overwrite</a> &middot; <a href="javascript:" id="un1fyFileFind">find</a> &middot; <a href="javascript:" id="un1fyFileCancel">cancel</a>').insertAfter("#un1fyPromptTitle").css({backgroundColor:"#fff8dd",color:"#333"}).fadeTo(300,1);$("#un1fyFileOver").bind("click",function(){imageLoader(true)});$("#un1fyFileCancel").bind("click",function(){imageOverwriteCancel();imageStatBuilder()});$("#un1fyFileFind").bind("click",function(){imageOverwriteCancel();linkFiles("#un1fyImgAddress")})};var imageOverwriteCancel=function(){$("#un1fyImgUpload").val("");$("#un1fyUploadAlert, #un1fyImgUploadIframe").remove();$("#un1fyImgLoc").attr("action","functions/upload.php?type=img")};var imageSrc=function(){if($("#un1fyImgAddress").val()!=""&&$("#un1fyImgAddress").val()!="http://"){$("#un1fyUploadImgClone",ifrDoc).remove();$("#un1fyImgUploadAlert").remove();$("#un1fyImgChoose").addClass("un1fyImgChooseInline");$("#un1fyImgUpload").val("");$("body",ifrDoc).append($("<img/>",ifrDoc).attr({src:$("#un1fyImgAddress").val(),id:"un1fyUploadImgClone"}));setTimeout(function(){imageStatBuilder($("#un1fyUploadImgClone",ifrDoc)[0])},100)}};var imageInfo=function(e,t,n,r,i,s){setTimeout(function(){if($("#un1fyPrompt").length){$("#un1fyUploadImgClone",ifrDoc).remove();$("#un1fyImgUploadAlert").remove();if(r.match(/successfully/gi)){if(i!=""){var o=fpath()!="/"?fpath()+s+i:s+i;$("body",ifrDoc).append($("<img/>",ifrDoc).attr({src:o,id:"un1fyUploadImgClone",height:n,width:t}));imageStatBuilder($("#un1fyUploadImgClone",ifrDoc)[0],e)}$("<p/>").addClass("un1fyImgUploadAlert un1fyPromptAlert").attr("id","un1fyImgUploadAlert").html(r).insertAfter("#un1fyPromptTitle").css("background-color","#82ac3f").fadeTo(300,1)}else{$("#un1fyImgStatArea").removeClass("un1fyUploadingImg").find("*").css("display","block");$("<p/>").addClass("un1fyImgUploadAlert un1fyPromptAlert").attr("id","un1fyImgUploadAlert").html(r).insertAfter("#un1fyPromptTitle").css("background-color","#c6242b").fadeTo(300,1)}}$("#un1fyImgUpload").val("");$("#un1fyUploadAlert").remove();$("#un1fyImgLoc").attr("action","functions/upload.php?type=img");$("#un1fyImgUploadIframe").remove()},100)};var imageDone=function(e){var t=new RegExp("((s)*\bun1fyEle\b(s)*|(s)*\bun1fyEle[0-9]+\b(s)*)","gi");var n=$("#un1fyImgStatArea img").attr("src");var r=$("#un1fyImgClass").val();var i=null;if($("#un1fyImgClass").val()!=""){i=$("#un1fyImgClass").val()+" unify"}else{i="unify"}var s="src::"+n+",alt::"+$("#un1fyImgAltTxt").val()+",class::"+i+",width::"+$("#un1fyImgStatsWidth").val()+",height::"+$("#un1fyImgStatsHeight").val()+",link::"+$("#un1fyImgLink").val()+",rel::"+$("#un1fyImgRel").val();$(e,ifrDoc).addClass("un1fyEle"+undoC);var o={src:n,alt:$("#un1fyImgAltTxt").val(),width:$("#un1fyImgStatsWidth").val(),height:$("#un1fyImgStatsHeight").val()};var u=$(e,ifrDoc).clone().addClass(r).attr(o);if($("#un1fyImgLink").val()!=$(e.parentNode,ifrDoc).attr("href")){$(e.parentNode,ifrDoc).attr({href:$("#un1fyImgLink").val()})}if($("#un1fyImgRel").val()&&$("#un1fyImgRel").val()!=$(e.parentNode,ifrDoc).attr("rel")){$(e.parentNode,ifrDoc).attr({rel:$("#un1fyImgRel").val()})}$(e,ifrDoc).replaceWith(u);addEdits(s,e,true);origImg=null};var imageInsert=function(){var e=getTinyDoc();var t=getEd();var n=$("#un1fyImgStatArea img").attr("src");var r='<img src="'+n+'" alt="'+$("#un1fyImgAltTxt").val()+'" class="'+$("#un1fyImgClass").val()+'" width="'+$("#un1fyImgStatsWidth").val()+'" height="'+$("#un1fyImgStatsHeight").val()+'" />';if(t){if($("#un1fyImgLink").val()){if($(t,e).parent("a").length){$(t,e).parent("a").attr("href",$("#un1fyImgLink").val());if($("#un1fyImgRel").val()){$(t,e).parent("a").attr("rel",$("#un1fyImgRel").val())}}else{var i='<a href="'+$("#un1fyImgLink").val()+'" ';if($("#un1fyImgRel").val()){i+='rel="'+$("#un1fyImgRel").val()+'" >'}r=i+r+"</a>"}}$(t,e).replaceWith(r)}else{if(e){setBookmark()}if($("#un1fyImgLink").val()){var i='<a href="'+$("#un1fyImgLink").val()+'" ';if($("#un1fyImgRel").val()){i+='rel="'+$("#un1fyImgRel").val()+'" >'}r=i+r+"</a>"}tinyMCE.execCommand("mceInsertRawHTML",true,r,{skip_undo:1})}cancel()};var videoPrompt=function(e){if(getTinyDoc()){getBookmark("simple")}if(!$("#un1fyPromptWrap").length){$(e,ifrDoc).addClass("un1fyEle");$("body").append($("<div/>").attr("id","un1fyPromptWrap").load("unify-temps/video-editor.html",function(){if(e){changeEmbed($(e,ifrDoc));$("#un1fyPromptTitle").html("Edit Video Embed");$("#un1fyPromptBtn").bind("click",function(){vidDone(e)});vidStatBuilder(e)}else{if(getEd()){var t=getTinyDoc();var n=getEd();if($(n,t).parent()[0].tagName=="OBJECT"){n=$(n,t).parent()}changeEmbed($(n,t));$("#un1fyPromptTitle").html("Edit Video Embed");vidStatBuilder(n)}else{vidStatBuilder()}}showPrompt()}))}};var vidStatBuilder=function(e){var e=e!=undefined?e||$("#un1fyVidClone",ifrDoc):false;var t=true;var n=true;if($("#un1fyOrigSize").length){t=$("#un1fyOrigSize:checked").length?true:false;n=$("#un1fyConstrain:checked").length?true:false}$("#un1fyVidStatArea").remove();if(e){var r=$(e,ifrDoc).find("param[name=movie]").length?$(e,ifrDoc).find("param[name=movie]").attr("value"):$(e,ifrDoc).attr("src");var i="";var s="";var o=r.split("/");var u=parseInt($(e,ifrDoc).attr("width"))||parseInt($(e,ifrDoc).width());var a=parseInt($(e,ifrDoc).attr("height"))||parseInt($(e,ifrDoc).height());if(r.match(/^http(s*):\/\//)){s="via "+o[2].replace(/www\./,"");i=o[o.length-1]}else{s=o[o.length-1];i=r}$("#un1fyPrompt").addClass("un1fyImgVidSelect");$("<div/>").addClass("un1fyVidStatArea clearfix").attr("id","un1fyVidStatArea").insertAfter("#un1fyVidChoose");$("#un1fyVidStatArea").append('<h4 id="un1fyVidTitle" class="un1fyVidTitle">'+s+"<span>"+i+'</span></h4><div id="un1fyEmbedWrap">'+eleHTML(e)+'</div><form action="javascript:" method="post" id="un1fyVidStats" class="un1fyVidStats"><label><input id="un1fyOrigSize" class="un1fyOrigSize" type="checkbox">Resize embed to fit</label><label><input id="un1fyVidStatsWidth" name="un1fyVidStatsWidth" type="text" value="'+u+'">width:</label><label><input id="un1fyVidStatsHeight" name="un1fyVidStatsHeight" type="text" value="'+a+'">height:</label><label class="un1fyConstrainLabel"><input id="un1fyConstrain" class="un1fyConstrain" type="checkbox">Keep proportions</label></form>');$("#un1fyEmbedWrap").html($("#un1fyEmbedWrap").html().replace(/width=(\"|\' )*[^\"\'\s]*(\"|\' )*/g,'width="145"').replace(/height=(\"|\' )*[^\"\'\s]*(\"|\' )*/g,'height="'+(a*(145/u)+20)+'"'));var f=$("object.un1fyEle, embed.un1fyEle",ifrDoc).length||getEd()?e:false;$("#un1fyPromptBtn").attr("title","Insert new video").html("insert").bind("click",function(){vidInsert(f)});if(t){$("#un1fyOrigSize").attr("checked","checked")}if(n){$("#un1fyConstrain").attr("checked","checked")}setTimeout(function(){vidOrigSize()},100)}else{$("#un1fyPrompt").removeClass("un1fyImgVidSelect");$("#un1fyPromptBtn").attr("title","Load embed").html("apply").bind("click",vidClone);$("#un1fyApplyBtn").css("display","none");vidBind()}};var changeEmbed=function(e){$("#un1fyVidEmbed").val(eleHTML(e))};var vidOrigSize=function(){$("#un1fyOrigSize").bind("click",vidOrigSize);if($("#un1fyOrigSize:checked").length){var e=getTinyDoc();var t=e?tinyMCE.activeEditor.selection.getNode():null;t=t!=null&&t.tagName!="EMBED"&&t.tagName!="OBJECT"?$(t,e).find("object")[0]||$(t,e).find("embed")[0]:t;var n=t||$(".un1fyEle",ifrDoc)[0];var r=parseInt(getCurStyle(n,"padding-top"));var i=parseInt(getCurStyle(n,"padding-right"));var s=parseInt(getCurStyle(n,"padding-left"));var o=parseInt(getCurStyle(n,"padding-bottom"));var u=$(n,ifrDoc).attr("width")?parseInt($(n,ifrDoc).attr("width")):parseInt($(n,ifrDoc).width());var a=$(n,ifrDoc).attr("height")?parseInt($(n,ifrDoc).attr("height")):parseInt($(n,ifrDoc).height());if(u==""||u=="0"){u=n.clientWidth?parseInt(n.clientWidth):parseInt(n.offsetWidth)}if(a==""||a=="0"){a=n.clientHeight?parseInt(n.clientHeight):parseInt(n.offsetHeight)}if(r!=0){a=a-r}if(o!=0){a=a-o}if(i!=0){u=u-i}if(s!=0){u=u-s}if($("#un1fyVidClone",ifrDoc).length){var f=$("#un1fyVidClone",ifrDoc).attr("width")||$("#un1fyVidClone",ifrDoc)[0].clientWidth?$("#un1fyVidClone",ifrDoc)[0].clientWidth:$("#un1fyVidClone",ifrDoc)[0].offsetWidth;var l=$("#un1fyVidClone",ifrDoc).attr("height")||$("#un1fyVidClone",ifrDoc)[0].clientHeight?$("#un1fyVidClone",ifrDoc)[0].clientHeight:$("#un1fyVidClone",ifrDoc)[0].offsetHeight;a=parseInt(l)*(u/parseInt(f));a=Math.round(a)}$("#un1fyVidStatsWidth").replaceWith($("<input/>").attr({name:"un1fyVidStatsWidth",id:"un1fyVidStatsWidth",type:"text",disabled:"disabled"}).css({backgroundColor:"#bbb",color:"#666"}));$("#un1fyVidStatsHeight").replaceWith($("<input/>").attr({name:"un1fyVidStatsHeight",id:"un1fyVidStatsHeight",type:"text",disabled:"disabled"}).css({backgroundColor:"#bbb",color:"#666"}));$("#un1fyVidStatsWidth").val(u);$("#un1fyVidStatsHeight").val(a);$(".un1fyConstrainLabel").css("color","#666").find("input").attr({disabled:"disabled",checked:"checked"})}else{var c=$("#un1fyVidStatsHeight").val();var h=$("#un1fyVidStatsWidth").val();$("#un1fyVidStatsWidth").replaceWith($("<input/>").attr({name:"un1fyVidStatsWidth",id:"un1fyVidStatsWidth",type:"text"}));$("#un1fyVidStatsHeight").replaceWith($("<input/>").attr({name:"un1fyVidStatsHeight",id:"un1fyVidStatsHeight",type:"text"}));if($("#un1fyVidClone",ifrDoc).length){$("#un1fyVidStatsWidth").val($("#un1fyVidClone",ifrDoc)[0].offsetWidth);$("#un1fyVidStatsHeight").val($("#un1fyVidClone",ifrDoc)[0].offsetHeight)}else{$("#un1fyVidStatsWidth").val(h);$("#un1fyVidStatsHeight").val(c)}$(".un1fyConstrainLabel").css("color","#ccc").find("input").removeAttr("disabled")}vidBind();if($("#un1fyVidEmbed").length){$("#un1fyVidEmbed").val($("#un1fyVidEmbed").val().replace(/width=(\"|\' )[^\"\']*(\"|\' )/g,'width="'+$("#un1fyVidStatsWidth").val().replace(/px/,"")+'"').replace(/height=(\"|\' )[^\"\']*(\"|\' )/g,'height="'+$("#un1fyVidStatsHeight").val().replace(/px/,"")+'"'))}};var vidClone=function(){if($("#un1fyVidEmbed").val()!=""){$("#un1fyVidClone",ifrDoc).remove();var e=$("#un1fyVidEmbed").val();e=$(e,ifrDoc).attr("id","un1fyVidClone");$("body",ifrDoc).append(e);vidStatBuilder($("#un1fyVidClone",ifrDoc))}};var vidConstrain=function(){$("#un1fyConstrain").unbind("click").bind("click",vidConstrain);if($("#un1fyConstrain:checked").length&&!$("#un1fyOrigSize:checked").length){$("#un1fyVidStatsWidth, #un1fyVidStatsHeight").bind("keyup",function(){var e=$(this).attr("id");changeVidSize(e)})}else{$("#un1fyVidStatsWidth, #un1fyVidStatsHeight").unbind("keyup").bind("keyup",function(){$("#un1fyVidEmbed").val($("#un1fyVidEmbed").val().replace(/width=(\"|\' )[^\"\']*(\"|\' )/g,'width="'+$("#un1fyVidStatsWidth").val().replace(/px/,"")+'"').replace(/height=(\"|\' )[^\"\']*(\"|\' )/g,'height="'+$("#un1fyVidStatsHeight").val().replace(/px/,"")+'"'))})}};var changeVidSize=function(e){var t=getTinyDoc();var n=t?tinyMCE.activeEditor.selection.getNode():null;var n=n!=null&&n.tagName!="EMBED"&&n.tagName!="OBJECT"?$(n,t).find("object")[0]||$(n,t).find("embed")[0]:n;var r=$(n,t)[0]||$(".un1fyEle",ifrDoc)[0];var i=$("#"+e).val();var s=parseInt($("#un1fyVidStatsWidth").val());var o=parseInt($("#un1fyVidStatsHeight").val());var u=t?t:ifrDoc;if($("#un1fyVidClone",ifrDoc).length){r=$("#un1fyVidClone",ifrDoc);u=ifrDoc}var a=parseInt($(r,u).attr("width"));var f=parseInt($(r,u).attr("height"));if(a==""||a=="0"){a=$(r,u)[0].clientWidth?$(r,u)[0].clientWidth:$(r,u)[0].offsetWidth}if(f==""||f=="0"){f=$(r,u)[0].clientHeight?$(r,u)[0].clientHeight:$(r,u)[0].offsetHeight}var l=e=="un1fyVidStatsHeight"?a/f:f/a;if(s/o!=l){var c=e=="un1fyVidStatsHeight"?"un1fyVidStatsWidth":"un1fyVidStatsHeight";var h=$("#"+e).val()*l;h=Math.round(h);$("#"+c).val(h)}};var vidBind=function(){vidConstrain();$("#un1fyApplyBtn").unbind("click").bind("click",vidClone);$("#un1fyVidStatsWidth, #un1fyVidStatsHeight").bind("keyup",function(){$("#un1fyVidEmbed").val($("#un1fyVidEmbed").val().replace(/width=(\"|\' )*[^\"\'\s]*(\"|\' )*/g,'width="'+$("#un1fyVidStatsWidth").val().replace(/px/,"")+'"').replace(/height=(\"|\' )*[^\"\'\s]*(\"|\' )*/g,'height="'+$("#un1fyVidStatsHeight").val().replace(/px/,"")+'"'))})};var vidDone=function(e){var t=$("#un1fyVidEmbed").val();var n=eleHTML($(t,ifrDoc).addClass("unify"));t=$(t,ifrDoc).addClass("un1fyEle un1fyEle"+undoC);$(e,ifrDoc).replaceWith($(t,ifrDoc));addEdits(n,e,false)};var vidInsert=function(e){var t=getTinyDoc();var n=$("<div/>",t).append($("#un1fyVidEmbed").val());if(e){if($(e,t).parent()[0].tagName=="OBJECT"){e=$(e,t).parent()}$(e,t).replaceWith($(n,t).html())}else{if(t){setBookmark()}tinyMCE.execCommand("mceInsertContent",true,$(n,t).html(),{skip_undo:1})}fixImgs();cancel()};var uploadPrompt=function(){if(!$("#un1fyPrompt").length){$("body").append($("<div/>").attr("id","un1fyPromptWrap").load("unify-temps/upload.html",function(){$("#un1fyPromptBtn, #un1fyCancelBtn").bind("click",cancel);folderLoader("file");showPrompt();$("#un1fyPrompt input:first").focus();$("#un1fyUpload").unbind("change").bind("change",function(){fileLoader(false)})}))}};var fileLoader=function(e){if($("#un1fyUpload").val()!=""){$("#un1fyUploadAlert, #un1fyFileInfo").remove();var t;try{t=document.createElement('<iframe name="un1fyUploadIframe" >')}catch(n){t=document.createElement("iframe")}$(t).attr({id:"un1fyUploadIframe",name:"un1fyUploadIframe",application:"yes"}).css("display","none").appendTo("body");if(e){$("#un1fyUploadForm").attr("action","functions/upload.php?over=true")}$("#un1fyUploadForm")[0].submit()}};var fileInfo=function(e,t,n,r){setTimeout(function(){if($("#un1fyPrompt").length){$("#un1fyUploadAlert, #un1fyFileInfo").remove();if(t.match(/successfully/gi)){if(n!=""){var i=r+n;var s=e.length>3?e.slice(0,e.length-3)+" kb":e+" bytes";$("<div/>").attr("id","un1fyFileInfo").addClass("un1fyFileInfo").append("<p>last upload:</p><h4>"+n+"<span>path: /"+r+"</span></h4>"+"<label>file size:<span>"+s+"</span></label>").insertAfter("#un1fyPromptTitle");$("#un1fyUploadTxt").html("To upload <em>another</em> file, select the folder you want to upload to:")}$("<p/>").addClass("un1fyUploadAlert un1fyPromptAlert").attr("id","un1fyUploadAlert").html(t).insertAfter("#un1fyPromptTitle").css("background-color","#82ac3f").fadeTo(300,1);$("#un1fyUpload").val("")}else{$("<p/>").addClass("un1fyUploadAlert un1fyPromptAlert").attr("id","un1fyUploadAlert").html(t).insertAfter("#un1fyPromptTitle").css("background-color","#c6242b").fadeTo(300,1)}}$("#un1fyUploadForm").attr("action","functions/upload.php");$("#un1fyUploadIframe").remove()},100)};var filePrompt=function(){$("<p/>").addClass("un1fyUploadAlert un1fyPromptAlert").attr("id","un1fyUploadAlert").html('This file already exists. <a href="javascript:" id="un1fyFileOver">overwrite</a> &middot; <a href="javascript:" id="un1fyFileCancel">cancel</a>').insertAfter("#un1fyPromptTitle").css({backgroundColor:"#fff8dd",color:"#333"}).fadeTo(300,1);$("#un1fyFileOver").bind("click",function(){fileLoader(true)});$("#un1fyFileCancel").bind("click",fileCancel)};var fileCancel=function(){$("#un1fyUpload").val("");$("#un1fyUploadAlert").remove();$("#un1fyUploadIframe").remove()};var defListBuilder=function(){getBookmark("simple");var e=getTinyDoc();var t=tinyMCE.activeEditor.selection.getNode();var n='<dl><dt id="caret">';var r=$(t,e).html();var i="</dt></dl>";$(t,e).replaceWith(n+r+i);setCaret($("#caret",e)[0],e)};var htmlPrompt=function(){if(!$("#un1fyPrompt").length){$("body").append($("<div/>").attr("id","un1fyPromptWrap").load("unify-temps/html-editor.html",function(){var e=getTinyDoc();var t=cleanContent($("body",e).find("[unifyid]").html(),true,e);var n=new CodeMirror(CodeMirror.replace("un1fyHtmlEditAreaTA"),{parserfile:["parsexml.js","parsecss.js","tokenizejavascript.js","parsejavascript.js","parsehtmlmixed.js"],path:"unify-js/codemirror/js/",stylesheet:"unify-js/codemirror/css/xmlcolors.css",height:Math.round($(window).height()*.6)+"px",width:"780px",tabMode:"shift",content:t});$("#un1fyPromptBtn").bind("click",function(){htmlInsert(n)});$("#un1fyCancelBtn").bind("click",cancel);$("a.fullscreen").unbind("click").bind("click",function(){editorFullscreen($(this).attr("rel"))}).removeClass("un1fyMinimize").attr({title:"Maximize this window"}).html("Maximize this window");$(".CodeMirror-wrapping").attr("id","un1fyCodeWrap");showPrompt()}))}else{$("#un1fyPrompt, #un1fyPromptContent").removeAttr("style");$("#un1fyCodeWrap, #un1fyHtmlEditAreaTA").width("780px").height(Math.round($(window).height()*.6));$("#un1fyPrompt a.fullscreen").unbind("click").bind("click",function(){editorFullscreen($(this).attr("rel"))}).removeClass("un1fyMinimize").attr({title:"Maximize this window"}).html("Maximize this window");showPrompt(false,true)}};var htmlInsert=function(e){var t=getTinyDoc();var n=$("#un1fyCodeWrap").length?e.getCode():$("#un1fyHtmlEditAreaTA").val();$("#un1fyEditContent")[0].innerHTML=n;$("body",t).find("[unifyid]")[0].innerHTML=n;fixImgs();if($.browser.msie){ieBind()}$("#un1fyEditContent_parent").css("display","block");cancel()};var makeTable=function(){var e=getTinyDoc();var t=tinyMCE.activeEditor.selection.getNode();if(e){getBookmark("simple")}if(!$("#un1fyPromptWrap").length){$("body").append($("<div/>").attr("id","un1fyPromptWrap").load("unify-temps/table-editor.html",function(){$("#un1fyTableRows").unbind("keyup").bind("keyup",insertRows).unbind("change").bind("change",function(){if($("#un1fyTableRows").val()==""||$("#un1fyTableRows").val()=="0"||!$("#un1fyTableRows").val().match(/^\d+$/)){$("#un1fyTableRows").val("1");insertRows()}});$("#un1fyTableCols").unbind("keyup").bind("keyup",insertCols).unbind("change").bind("change",function(){if($("#un1fyTableCols").val()==""||$("#un1fyTableCols").val()=="0"||!$("#un1fyTableCols").val().match(/^\d+$/)){$("#un1fyTableCols").val("1");insertCols()}});$("#un1fyTableThead").unbind("click").bind("click",insertThead);$("#un1fyTableTfoot").unbind("click").bind("click",insertTfoot);$("#un1fyTableID").unbind("keydown").bind("keydown",tableID);$("#un1fyTableClass").unbind("keydown").bind("keydown",function(){$("#un1fyTablePrev table").attr("class",$(this).val())});$("#un1fyPrompt #un1fyPromptBtn").unbind("click").bind("click",function(){insertTable(t)});showPrompt()}))}};var insertRows=function(){var e=Math.round($("#un1fyTableRows").val());var t=$("#un1fyTablePrev tbody tr");if(e!=""&&e!="0"&&e!=t.length&&e.toString().match(/^\d+$/)){var n=t[0];$("#un1fyTablePrev tbody tr").remove();while(e>"0"){n=$(n).clone();$("#un1fyTablePrev tbody").append(n[0]);e--}}};var insertCols=function(){var e=Math.round($("#un1fyTableCols").val());var t=$("#un1fyTablePrev tbody tr:first td");if(e!=""&&e!="0"&&e!=t.length&&e.toString().match(/^\d+$/)){$("#un1fyTablePrev tbody td").remove();$("#un1fyTablePrev tbody tr").each(function(){var t=e;while(t>"0"){$(this).append($("<td/>").html("&nbsp;"));t--}});insertThead();insertTfoot()}};var insertThead=function(){var e=$("#un1fyTablePrev tbody tr:first td");$("#un1fyTablePrev thead").remove();if($("#un1fyTableThead:checked").length){$("#un1fyTablePrev table").prepend("<thead><tr></tr></thead>");e.each(function(){$("#un1fyTablePrev thead tr").append($("<th/>").html("&nbsp;"))})}};var insertTfoot=function(){var e=$("#un1fyTablePrev tbody tr:first td");$("#un1fyTablePrev tfoot").remove();if($("#un1fyTableTfoot:checked").length){$("#un1fyTablePrev table").append("<tfoot><tr></tr></tfoot>");e.each(function(){$("#un1fyTablePrev tfoot tr").append($("<td/>").html("&nbsp;"))})}};var tableID=function(){if(!$("#un1fyTableID").val().match(/\s/gi)){$("#un1fyTablePrev table").attr("id",$("#un1fyTableID").val())}else{$("#un1fyTableID").val($("#un1fyTablePrev table").attr("id"))}};var insertTable=function(e){var t=getTinyDoc();var n=$(e,t).html();$("#un1fyTablePrev td:first").attr("id","caret").append(n).html();$(e,t).replaceWith($("#un1fyTablePrev").html());setCaret($("#caret",t)[0],t);cancel()};var makeLink=function(){var e=getTinyDoc();if(e){getBookmark("simple")}if(tinyMCE.activeEditor.selection.getNode().nodeName=="A"){var t=tinyMCE.activeEditor.selection.getNode()}else if(tinyMCE.activeEditor.selection.getNode().parentNode.nodeName=="A"){var t=tinyMCE.activeEditor.selection.getNode().parentNode}if(!$("#un1fyPrompt").length){$("body").append($("<div/>").attr("id","un1fyPromptWrap").load("unify-temps/link-editor.html",function(){if(t){$("#un1fyPromptBtn").html("done").bind("click",function(){linkReplace(t)});$("#un1fyPromptTitle").html("Edit Link");$("#un1fyLinkID").val($(t,e).attr("id"));$("#un1fyLinkURL").val($(t,e).attr("href"));$("#un1fyLinkClass").val($(t,e).attr("class"));$("#un1fyLinkTitle").val($(t,e).attr("title"));$("#un1fyLinkRel").val($(t,e).attr("rel"));$("#un1fyLinkTarget").val($(t,e).attr("target"));$("<p/>").addClass("un1fyLinkRemove").prependTo("#un1fyLinkProperties").append($("<a/>").attr({href:"javascript:",title:"Unlink this selection"}).html("remove this link").bind("click",function(){linkRemove(t)}))}else{$("#un1fyPromptBtn").html("insert").bind("click",linkInsert);$("#un1fyPromptTitle").html("Create Link")}$("#un1fyCancelBtn").bind("click",cancel);fBrowseBind();showPrompt()}))}};var linkInsert=function(){var e=getTinyDoc();var t=!$("#un1fyLinkURL").val().match(/^http(s*):\/\/|@/)?fpath()+$("#un1fyLinkURL").val():$("#un1fyLinkURL").val();if($("#un1fyLinkURL").val()!=""&&$("#un1fyLinkURL").val()!="http://"){$("#un1fyLinkAlert").remove();setBookmark();var n=tinyMCE.activeEditor.selection.getContent({format:"text"});var r=tinyMCE.activeEditor.selection.getNode();if($(r,e)[0].tagName=="IMG"){var i=$("<div/>",e).append($(r,e).clone());n=$(i).html()}var s='<a href="'+t+'" ';if($("#un1fyLinkID").val()){s+='id="'+$("#un1fyLinkID").val()+'" '}if($("#un1fyLinkClass").val()){s+='class="'+$("#un1fyLinkClass").val()+'" '}if($("#un1fyLinkTitle").val()){s+='title="'+$("#un1fyLinkTitle").val()+'" '}if($("#un1fyLinkRel").val()){s+='rel="'+$("#un1fyLinkRel").val()+'" '}if($("#un1fyLinkTarget").val()){s+='target="'+$("#un1fyLinkTarget").val()+'" '}s+=">"+n+"</a>";tinyMCE.execCommand("mceInsertContent",true,s,{skip_undo:1});cancel()}else{$("<p/>").addClass("un1fyLinkAlert").attr("id","un1fyLinkAlert").html("You must enter a URL").prependTo("#un1fyLinkContent").fadeTo(300,1)}$("a",e).removeAttr("_mce_href")};var linkReplace=function(e){var t=getTinyDoc();var n=!$("#un1fyLinkURL").val().match(/^http(s*):\/\/|@/)?fpath()+$("#un1fyLinkURL").val():$("#un1fyLinkURL").val();if($(e,t)[0].tagName=="IMG"){e=$(e,t).parent()}if(n!=""&&n!="http://"){$(e,t).removeAttr("class");if($("#un1fyLinkClass").val()){$(e,t).addClass($("#un1fyLinkClass").val())}if(n!=$(e,t).attr("href")){$(e,t).attr({href:n,_mce_href:n})}if($("#un1fyLinkRel").val()!=$(e,t).attr("rel")){$(e,t).attr({rel:$("#un1fyLinkRel").val()})}if($("#un1fyLinkTarget").val()!=$(e,t).attr("target")){$(e,t).attr({target:$("#un1fyLinkTarget").val()})}if($("#un1fyLinkID").val()!=""){$(e,t).attr({id:$("#un1fyLinkID").val()})}$(e,t).attr("title",$("#un1fyLinkTitle").val());cancel()}else{linkRemove()}$("a",t).removeAttr("_mce_href")};var linkRemove=function(e){var t=$(e).html();$(e).replaceWith(t);fixImgs();cancel()};var logoutPrompt=function(){if($("#un1fyPageEdits textarea.edit",ifrDoc).length){overlay();if(!$("#un1fyPrompt").length){$("body").append($("<div/>").attr("id","un1fyPromptWrap").load("unify-temps/prompt.html",function(){$("#un1fyPrompt h4.un1fyPromptTitle").html("Logout");$("#un1fyPrompt p").html("You have unpublished changes that will be lost. Do you still wish to log out?");$("#un1fyPromptBtn").attr("title","logout").html("logout").bind("click",logout);$("#un1fyCancelBtn").bind("click",cancel);showPrompt("nodrag")}))}}else{logout()}};var logout=function(){$.ajax({type:"POST",url:"functions/logout.php",success:function(){window.location=retUrl()}})};var restorePrompt=function(){overlay();if(!$("#un1fyPrompt").length){$("body").append($("<div/>").attr("id","un1fyPromptWrap").load("unify-temps/prompt.html",function(){$("#un1fyPrompt h4.un1fyPromptTitle").html("Restore");$("#un1fyPrompt p").html("Restore will change all files associated with this page back to their last published version. This cannot be undone. Do you still wish to restore?");$("#un1fyPromptBtn").attr("title","Restore this page to last published version").html("restore").bind("click",restoreSubmit);$("#un1fyCancelBtn").bind("click",cancel);showPrompt("nodrag");$("body",ifrDoc).append($("<form/>",ifrDoc).attr({name:"un1fyRestoreForm",id:"un1fyRestoreForm",action:un1fyGlobalPath+"/functions/restore.php",method:"POST",target:"un1fyRestIframe"}).css("display","none"))}))}};var restoreSubmit=function(){$("#un1fyPromptWrap").remove();var e;try{e=ifrDoc.createElement('<iframe name="un1fyRestIframe" >')}catch(t){e=ifrDoc.createElement("iframe")}$(e,ifrDoc).attr({id:"un1fyRestIframe",name:"un1fyRestIframe",application:"yes"});$("body",ifrDoc).append(e);$("#un1fyRestoreForm",ifrDoc)[0].submit()};var cancelAllPrompt=function(){overlay();if(!$("#un1fyPrompt").length){$("body").append($("<div/>").attr("id","un1fyPromptWrap").load("unify-temps/prompt.html",function(){$("#un1fyPrompt h4.un1fyPromptTitle").html("Cancel All");$("#un1fyPrompt p").html("Are you sure you want to clear all changes since your last publish?");$("#un1fyPromptBtn").attr("title","Clear all changes since last publish").html("clear").bind("click",cancelAllSubmit);$("#un1fyCancelBtn").bind("click",cancel);showPrompt("nodrag")}))}};var cancelAllSubmit=function(){$("#un1fyPromptWrap").remove();ifrReload()};var done=function(e){var t=getTinyDoc();var n=e.tagName.match(/(h[0-9]|p)/i)?false:true;var r=!n&&$("[unifyid]",t).find(e.tagName).length?$("[unifyid]",t).parent().html():$("[unifyid]",t).html();var i=$(e,ifrDoc);i.find(".un1fyFlash").removeClass("un1fyFlash");if(r){r=cleanContent(r,n,t);var s=i.clone();if(i[0].tagName.match(/TR|THEAD|TBODY/)){s.html(r)}else{s[0].innerHTML=r}i.replaceWith(s)}else{i.html("&nbsp;")}addEdits(cleanContent($(".un1fyEle",ifrDoc).html(),n,ifrDoc),e,false)};var addEdits=function(e,t,n){var r=$(t,ifrDoc).attr("unifyid").replace("un1fyEditArea","");var i=!n?"edit"+r:"editImg"+r;createUndo(t);if(!$("#un1fyEditTA"+r,ifrDoc).length){$("<textarea/>",ifrDoc).addClass("edit").attr({name:i,id:"un1fyEditTA"+r,rows:"1",cols:"1"}).appendTo($("#un1fyPageEdits",ifrDoc))}$("#un1fyEditTA"+r,ifrDoc).val(e);undoC++;redoOff();linkBind();cancel()};var undo=function(){destroyIcons();if(undoC<=0){undoC=0}else{undoC--}var e=".un1fyEle"+undoC;var t=$(e,ifrDoc);if(t.length){createRedo(e);if(t[0].tagName!="IMG"){var n=$("#un1fyGlobalUndo #un1fyUndoNum"+undoC+" "+e).find("a.un1fyIcon").css({opacity:"1"}).end().html();t.html(n)}else{var n=$("#un1fyGlobalUndo #un1fyUndoNum"+undoC).html();t.replaceWith(n)}if($(e,ifrDoc).hasClass("unifyRepeatArea")){var r=t.clone().find(".un1fyPlaceholder").remove().end()}else{var r=t[0]}var i=t.parent().attr("id");i=i!=undefined?i.replace("un1fyEditArea",""):false;changePageEdits(r,i)}unifyGlobals();if(t.attr("class").match(/unifyRepeatArea/g)){unifyRepBind();$(".un1fyRep .un1fyIcon",ifrDoc).css({display:"block",opacity:"1"})}createIcons()};var redo=function(){destroyIcons();var e=".un1fyEle"+undoC;var t=$(e,ifrDoc);if(t.length){if(t[0].tagName!="IMG"){var n=$("#un1fyGlobalRedo #un1fyRedoNum"+undoC+" "+e).find("a.un1fyIcon").css({opacity:"1"}).end().html();t.replaceWith(t.clone().html(n))}else{var n=$("#un1fyGlobalRedo #un1fyRedoNum"+undoC).html();t.replaceWith(n)}if(t.hasClass("unifyRepeatArea")){var r=t.clone().find(".un1fyPlaceholder").remove().end()}else{var r=t[0]}var i=t.parent().attr("id");i=i!=undefined?i.replace("un1fyEditArea",""):false;changePageEdits(r,i);undoC++}unifyGlobals();var s=t.attr("class");s=s!=undefined?s.match(/unifyRepeatArea/g):false;if(s){unifyRepBind();$(".un1fyRep .un1fyIcon",ifrDoc).css({display:"block",opacity:"1"})}createIcons()};var redoOff=function(){$("#un1fyGlobalRedo").remove();$("#un1fyGlobalUndo div").each(function(){var e=$(this).attr("id");var t=e!=undefined?e.replace("un1fyUndoNum",""):-1;if(t>=undoC){$(this).remove();$(".un1fyEle"+t,ifrDoc).removeClass("un1fyEle"+t);$(".un1fyEle"+t).removeClass("un1fyEle"+t)}});$(".un1fyEle"+(undoC-1),ifrDoc).removeClass("un1fyEle"+(undoC-1));$(".un1fyEle",ifrDoc).addClass("un1fyEle"+(undoC-1));unifyGlobals()};var publish=function(){if($("#un1fyPageEdits textarea.edit",ifrDoc).length){var e;try{e=ifrDoc.createElement('<iframe name="un1fyPubIframe" >')}catch(t){e=ifrDoc.createElement("iframe")}$(e,ifrDoc).attr({id:"un1fyPubIframe",name:"un1fyPubIframe",application:"yes"}).css("display","none").appendTo($("body",ifrDoc));$("#un1fyPageEdits",ifrDoc)[0].submit();$("#un1fyGlobalUndo, #un1fyGlobalRedo").remove();undoC=0;unifyGlobals()}};var dragOn=function(e,t){$(e).draggable({handle:t,containment:"parent",start:function(){$(window).unbind("resize")}});if($("#un1fyEditWrap").length){$("#un1fyEditWrap").resizable({handles:"all",alsoResize:".mceIframeContainer",start:function(){frameShim();$(window).unbind("resize")}})}}